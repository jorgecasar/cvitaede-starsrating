<dom-module id="cvitaede-starsrating">
  <template>
    <style>
     :host {
        display: block;
        max-width: 500px;
        min-height: 40px;
        font-size: 30px;
        --star-size: 1em;
        --star-color: #FFD700;
      }
      
      :host fieldset,
      :host label {
        margin: 0;
        padding: 0;
      }
      
      :host .rating {
        border: none;
        float: left;
      }
      
      :host .rating>input {
        display: none;
      }
      
      :host .rating > label:before {
        margin: 5px;
        font-size: var(--star-size);
        display: inline-block;
        content: "\2605";
      }
      
      :host .rating > .half:before {
        content: "\f089";
        position: absolute;
      }
      
      :host .rating > label {
        color: var(--star-color);
        float: right;
        opacity: 0.3;
      }
      
      :host .rating > input[checked] ~ label {
        color: var(--star-color);
        opacity: 1;
      }
    </style>

    <fieldset class="rating">
      <template is="dom-repeat" items="[[_stars]]">
        <input type="radio" id$="star[[_computeIndex(index)]]" name="rating" value="[[_computeIndex(index)]]" disabled />
        <label for="star[[_computeIndex(index)]]"></label>
      </template>
    </fieldset>
  </template>

  <script>
    class CvitaedeStarsrating extends Polymer.Element {

      static get is() { return 'cvitae-starsrating'; }

      static get properties() {
        return {
          _stars: {
            type: Object
          },
          numStars: {
            type: Number,
            value: 7
          },
          starSize: {
            type: String,
            value: "1em"
          },
          rating: {
            type: Number,
            value: 0
          },
          mode: {
            type: String,
            value: "auto"
          }
        };
      }

      constructor() {
        super();
        this._stars = new Array(this.numStars);
      }
    
      connectedCallback() { 
        super.connectedCallback();
        if (this.mode === 'manual') {
          this.querySelectorAll('label').forEach(
            function(label) { 
              label.addEventListener('click', 
                function(ev) {
                  this.querySelectorAll('input').forEach( function(item) { item.removeAttribute('checked'); });
                  this.querySelector('#' +ev.target.for).setAttribute('checked', 'checked');
                  this.rating = parseInt(ev.target.for.replace('star',''));
                }.bind(this)
              );
            }.bind(this)
          );
        }
        if (this.rating > 0) {
          this.querySelector('#star' + this.rating).setAttribute('checked', 'checked');
          this.customStyle['--star-size'] = this.starSize;
          this.updateStyles();
        }
      }

      _computeIndex(index) {
        return this.numStars - index;
      }
    }

    window.customElements.define(CvitaedeStarsrating.is, CvitaedeStarsrating);
  </script>
</dom-module>
