<link rel="import" href="./bower_components/polymer/polymer.html">

<dom-module id="cvitaede-starsrating">
  <template>
    <style>
     :host {
        display: block;
        max-width: 500px;
        min-height: 40px;
        font-size: 30px;
        --var-star-size: 3em;
      }
      
      :host fieldset,
      :host label {
        margin: 0;
        padding: 0;
      }
      
      :host .rating {
        border: none;
        float: left;
      }
      
      :host .rating>input {
        display: none;
      }
      
      :host .rating > label:before {
        margin: 5px;
        font-size: var(--star-size);
        display: inline-block;
        content: "\2605";
      }
      
      :host .rating > .half:before {
        content: "\f089";
        position: absolute;
      }
      
      :host .rating > label {
        color: #ddd;
        float: right;
      }
      
      :host .rating > input[checked] ~ label {
        color: #FFD700;
      }
    </style>

    <fieldset class="rating">
      <template is="dom-repeat" items="[[_stars]]">
        <input type="radio" id$="star[[_computeIndex(index)]]" name="rating" value="[[_computeIndex(index)]]" disabled />
        <label for="star[[_computeIndex(index)]]"></label>
      </template>
    </fieldset>
  </template>

  <script>
  Polymer({

    is: 'cvitaede-starsrating',

    properties: {
      _stars: {
        type: Object
      },
      numStars: {
        type: Number,
        value: 7
      },
      starSize: {
        type: String,
        value: "1em"
      },
      rating: {
        type: Number,
        value: 0
      },
      mode: {
        type: String,
        value: "auto"
      }
    },
    ready: function() {
      this._stars = new Array(this.numStars);
    },
    attached: function() {
      if (this.mode === 'manual') {
        this.querySelectorAll('label').forEach(
          function(label) { 
            label.addEventListener('click', 
              function(ev) {
                this.querySelectorAll('input').forEach( function(item) { item.removeAttribute('checked'); });
                this.querySelector('#' +ev.target.for).setAttribute('checked', 'checked');
                this.rating = parseInt(ev.target.for.replace('star',''));
              }.bind(this)
            );
          }.bind(this)
        );
      }
      if (this.rating > 0) {
        this.querySelector('#star' + this.rating).setAttribute('checked', 'checked');
        this.customStyle['--star-size'] = this.starSize;
        this.updateStyles();
      }
    },
    _attached: function() {
      console.log(this.querySelector('#star' + this.rating));
      this.querySelector('#star' + this.rating).setAttribute('checked', 'checked');
      this.customStyle['--star-size'] = this.starSize;
      this.updateStyles();
    },
    _computeIndex: function(index) {
      return this.numStars - index;
    }
  });

  </script>
</dom-module>
